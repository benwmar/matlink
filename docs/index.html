<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-08">

<title>CDC / Johns Hopkins Technical Guide to Getting Started with MATLINK – MATLINK</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MATLINK</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome" id="toc-welcome" class="nav-link active" data-scroll-target="#welcome">Welcome</a>
  <ul class="collapse">
  <li><a href="#intro-video-khyzer-and-paul-need-a-place-to-store-the-video-too-large-for-github" id="toc-intro-video-khyzer-and-paul-need-a-place-to-store-the-video-too-large-for-github" class="nav-link" data-scroll-target="#intro-video-khyzer-and-paul-need-a-place-to-store-the-video-too-large-for-github">INTRO VIDEO, KHYZER AND PAUL: NEED A PLACE TO STORE THE VIDEO – TOO LARGE FOR GITHUB</a></li>
  <li><a href="#diagram-of-matlink-program" id="toc-diagram-of-matlink-program" class="nav-link" data-scroll-target="#diagram-of-matlink-program">DIAGRAM OF MATLINK program?</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#meeting-schedule" id="toc-meeting-schedule" class="nav-link" data-scroll-target="#meeting-schedule">Meeting schedule</a></li>
  <li><a href="#redcap-training-resouces" id="toc-redcap-training-resouces" class="nav-link" data-scroll-target="#redcap-training-resouces">REdCAP Training Resouces</a></li>
  <li><a href="#matlink-specific-redcap-resources-faqs---tbd" id="toc-matlink-specific-redcap-resources-faqs---tbd" class="nav-link" data-scroll-target="#matlink-specific-redcap-resources-faqs---tbd">MATLINK-specific REDCap resources, FAQs - TBD</a></li>
  </ul></li>
  <li><a href="#data-content-ontology" id="toc-data-content-ontology" class="nav-link" data-scroll-target="#data-content-ontology">Resources to help you on your REDCap journey</a>
  <ul class="collapse">
  <li><a href="#overview-of-major-clinical-terminologies-and-coding-systems" id="toc-overview-of-major-clinical-terminologies-and-coding-systems" class="nav-link" data-scroll-target="#overview-of-major-clinical-terminologies-and-coding-systems">Overview of Major Clinical Terminologies and Coding Systems</a>
  <ul class="collapse">
  <li><a href="#snomed-clinical-terms-snomed-ct" id="toc-snomed-clinical-terms-snomed-ct" class="nav-link" data-scroll-target="#snomed-clinical-terms-snomed-ct">SNOMED Clinical Terms (SNOMED CT)</a></li>
  <li><a href="#logical-observation-identifiers-names-and-codes-loinc" id="toc-logical-observation-identifiers-names-and-codes-loinc" class="nav-link" data-scroll-target="#logical-observation-identifiers-names-and-codes-loinc">Logical Observation Identifiers Names and Codes (LOINC)</a></li>
  <li><a href="#rxnorm" id="toc-rxnorm" class="nav-link" data-scroll-target="#rxnorm">RxNorm</a></li>
  <li><a href="#international-classification-of-disease-icd" id="toc-international-classification-of-disease-icd" class="nav-link" data-scroll-target="#international-classification-of-disease-icd">International Classification of Disease (ICD)</a></li>
  <li><a href="#current-procedural-terminology-cpt" id="toc-current-procedural-terminology-cpt" class="nav-link" data-scroll-target="#current-procedural-terminology-cpt">Current Procedural Terminology (CPT)</a></li>
  <li><a href="#human-phenotype-ontology-hpo" id="toc-human-phenotype-ontology-hpo" class="nav-link" data-scroll-target="#human-phenotype-ontology-hpo">Human Phenotype Ontology (HPO)</a></li>
  <li><a href="#unified-medical-language-system-umls" id="toc-unified-medical-language-system-umls" class="nav-link" data-scroll-target="#unified-medical-language-system-umls">Unified Medical Language System (UMLS)</a></li>
  <li><a href="#ontology-mapping-in-bioportal-applications" id="toc-ontology-mapping-in-bioportal-applications" class="nav-link" data-scroll-target="#ontology-mapping-in-bioportal-applications">Ontology Mapping in BioPortal Applications</a></li>
  </ul></li>
  <li><a href="#omop-domains-by-source-to-standard-vocabulary" id="toc-omop-domains-by-source-to-standard-vocabulary" class="nav-link" data-scroll-target="#omop-domains-by-source-to-standard-vocabulary">OMOP Domains by Source to Standard Vocabulary</a></li>
  <li><a href="#welcome-to-omop-for-matlink-users" id="toc-welcome-to-omop-for-matlink-users" class="nav-link" data-scroll-target="#welcome-to-omop-for-matlink-users">Welcome to OMOP for MATLINK users</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a></li>
  <li><a href="#matlink-technical-support-checklist" id="toc-matlink-technical-support-checklist" class="nav-link" data-scroll-target="#matlink-technical-support-checklist">MATLINK technical support checklist</a>
  <ul class="collapse">
  <li><a href="#ohdsi-etl-resources" id="toc-ohdsi-etl-resources" class="nav-link" data-scroll-target="#ohdsi-etl-resources"><u>OHDSI ETL Resources</u></a></li>
  <li><a href="#ohdsi-etl-steps" id="toc-ohdsi-etl-steps" class="nav-link" data-scroll-target="#ohdsi-etl-steps"><u>OHDSI ETL Steps</u></a></li>
  <li><a href="#places-to-connect" id="toc-places-to-connect" class="nav-link" data-scroll-target="#places-to-connect"><u>Places to Connect</u></a></li>
  </ul></li>
  <li><a href="#omop-table-and-field-basics" id="toc-omop-table-and-field-basics" class="nav-link" data-scroll-target="#omop-table-and-field-basics">OMOP Table and Field Basics</a></li>
  </ul></li>
  <li><a href="#ohdsi-tool-suite" id="toc-ohdsi-tool-suite" class="nav-link" data-scroll-target="#ohdsi-tool-suite">OHDSI Tool Suite</a></li>
  <li><a href="#omop-scripts-for-epic" id="toc-omop-scripts-for-epic" class="nav-link" data-scroll-target="#omop-scripts-for-epic">OMOP Scripts for Epic</a></li>
  <li><a href="#using-synthetic-data" id="toc-using-synthetic-data" class="nav-link" data-scroll-target="#using-synthetic-data">Using synthetic data</a></li>
  <li><a href="#useful-resources" id="toc-useful-resources" class="nav-link" data-scroll-target="#useful-resources">Useful Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CDC / Johns Hopkins Technical Guide to Getting Started with MATLINK</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="welcome" class="level1">
<h1>Welcome</h1>
<section id="intro-video-khyzer-and-paul-need-a-place-to-store-the-video-too-large-for-github" class="level2">
<h2 class="anchored" data-anchor-id="intro-video-khyzer-and-paul-need-a-place-to-store-the-video-too-large-for-github">INTRO VIDEO, KHYZER AND PAUL: NEED A PLACE TO STORE THE VIDEO – TOO LARGE FOR GITHUB</h2>
</section>
<section id="diagram-of-matlink-program" class="level2">
<h2 class="anchored" data-anchor-id="diagram-of-matlink-program">DIAGRAM OF MATLINK program?</h2>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Miele K, Kim SY, Jones R, et al.&nbsp;Medication for Opioid Use Disorder During Pregnancy — Maternal and Infant Network to Understand Outcomes Associated with Use of Medication for Opioid Use Disorder During Pregnancy (MAT-LINK), 2014–2021. MMWR Surveill Summ 2023;72(No.&nbsp;SS-3):1–14. <a href="http://dx.doi.org/10.15585/mmwr.ss7203a1">DOI: http://dx.doi.org/10.15585/mmwr.ss7203a1</a>. <a href="https://www.cdc.gov/mmwr/volumes/72/ss/ss7203a1.htm" class="uri">https://www.cdc.gov/mmwr/volumes/72/ss/ss7203a1.htm</a></p>
</section>
<section id="meeting-schedule" class="level2">
<h2 class="anchored" data-anchor-id="meeting-schedule">Meeting schedule</h2>
</section>
<section id="redcap-training-resouces" class="level2">
<h2 class="anchored" data-anchor-id="redcap-training-resouces">REdCAP Training Resouces</h2>
<p><a href="https://projectredcap.org/resources/videos/">REDCap training videos</a></p>
</section>
<section id="matlink-specific-redcap-resources-faqs---tbd" class="level2">
<h2 class="anchored" data-anchor-id="matlink-specific-redcap-resources-faqs---tbd">MATLINK-specific REDCap resources, FAQs - TBD</h2>
</section>
</section>
<section id="data-content-ontology" class="level1">
<h1>Resources to help you on your REDCap journey</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://img.youtube.com/vi/4uXqNLsiVuc/maxresdefault.jpg" class="img-fluid figure-img"></p>
<figcaption>Dr.&nbsp;Rachel Richesson presents “Learning to Use EHR Data in Learning Health Systems”</figcaption>
</figure>
</div>
<section id="overview-of-major-clinical-terminologies-and-coding-systems" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-major-clinical-terminologies-and-coding-systems">Overview of Major Clinical Terminologies and Coding Systems</h2>
<p>This document provides a detailed overview of several essential clinical terminologies and coding systems used in healthcare. Each system has a specific role and is crucial for standardized communication in healthcare settings. The information includes development history, usage, and updates of these systems.</p>
<p>For more in-depth information, links to the respective official websites are provided.</p>
<section id="snomed-clinical-terms-snomed-ct" class="level3">
<h3 class="anchored" data-anchor-id="snomed-clinical-terms-snomed-ct">SNOMED Clinical Terms (SNOMED CT)</h3>
<ul>
<li><strong>Development:</strong> Originally by the College of American Pathologists, now under SNOMED International.</li>
<li><strong>Adoption:</strong> Used in over 50 countries.</li>
<li><strong>Concepts:</strong> Over 340,000 active concepts in 19 hierarchies.</li>
<li><strong>Usage:</strong> Encodes clinical information including diseases, findings, and procedures.</li>
<li><strong>Updates:</strong> Biannual, with more frequent updates planned.</li>
<li><strong>More Information:</strong> <a href="https://www.snomed.org/snomed-ct">SNOMED International</a></li>
</ul>
</section>
<section id="logical-observation-identifiers-names-and-codes-loinc" class="level3">
<h3 class="anchored" data-anchor-id="logical-observation-identifiers-names-and-codes-loinc">Logical Observation Identifiers Names and Codes (LOINC)</h3>
<ul>
<li><strong>Developer:</strong> Regenstrief Institute.</li>
<li><strong>Function:</strong> Identifiers for laboratory and clinical observations.</li>
<li><strong>Content:</strong> Over 90,000 terms.</li>
<li><strong>Collaboration:</strong> With SNOMED CT for coded content development.</li>
<li><strong>Updates:</strong> Biannual.</li>
<li><strong>More Information:</strong> <a href="https://loinc.org">LOINC</a></li>
</ul>
</section>
<section id="rxnorm" class="level3">
<h3 class="anchored" data-anchor-id="rxnorm">RxNorm</h3>
<ul>
<li><strong>Developer:</strong> National Library of Medicine (NLM).</li>
<li><strong>Function:</strong> Standard nomenclature for medications.</li>
<li><strong>Integration:</strong> Links to various drug vocabularies.</li>
<li><strong>Access:</strong> Requires UMLS user license for proprietary content.</li>
<li><strong>More Information:</strong> <a href="https://www.nlm.nih.gov/research/umls/rxnorm">RxNorm - NLM</a></li>
</ul>
</section>
<section id="international-classification-of-disease-icd" class="level3">
<h3 class="anchored" data-anchor-id="international-classification-of-disease-icd">International Classification of Disease (ICD)</h3>
<ul>
<li><strong>Endorsement:</strong> World Health Organization (WHO).</li>
<li><strong>Versions:</strong> ICD-10 widely used with national extensions; ICD-11 adopted for future use.</li>
<li><strong>Purpose:</strong> Epidemiology, health management, clinical purposes.</li>
<li><strong>Updates:</strong> Annual, freely available.</li>
<li><strong>More Information:</strong> <a href="https://www.who.int/classifications/icd">WHO ICD</a></li>
</ul>
</section>
<section id="current-procedural-terminology-cpt" class="level3">
<h3 class="anchored" data-anchor-id="current-procedural-terminology-cpt">Current Procedural Terminology (CPT)</h3>
<ul>
<li><strong>Developer:</strong> American Medical Association (AMA).</li>
<li><strong>Use:</strong> Encoding of medical services and procedures in the USA.</li>
<li><strong>Categories:</strong> Three categories of codes.</li>
<li><strong>Requirement:</strong> License from AMA for use.</li>
<li><strong>More Information:</strong> <a href="https://www.ama-assn.org/practice-management/cpt">CPT - AMA</a></li>
</ul>
</section>
<section id="human-phenotype-ontology-hpo" class="level3">
<h3 class="anchored" data-anchor-id="human-phenotype-ontology-hpo">Human Phenotype Ontology (HPO)</h3>
<ul>
<li><strong>Function:</strong> Bioinformatic resources for human diseases and phenotypes analysis.</li>
<li><strong>Components:</strong> Phenotype vocabulary, disease-phenotype annotations, algorithms.</li>
<li><strong>Applications:</strong> Genomic interpretation, gene-disease discovery, precision medicine.</li>
<li><strong>Content:</strong> Over 13,000 terms in 5 hierarchies.</li>
<li><strong>Availability:</strong> Freely available, multiple releases per year.</li>
<li><strong>More Information:</strong> <a href="https://hpo.jax.org">Human Phenotype Ontology</a></li>
</ul>
</section>
<section id="unified-medical-language-system-umls" class="level3">
<h3 class="anchored" data-anchor-id="unified-medical-language-system-umls">Unified Medical Language System (UMLS)</h3>
<ul>
<li><strong>Initiation:</strong> By the US National Library of Medicine in 1986.</li>
<li><strong>Goal:</strong> To aid in the retrieval and integration of electronic biomedical information.</li>
<li><strong>Challenge Addressed:</strong> Different vocabularies expressing the same information differently.</li>
<li><strong>Availability:</strong> Free, but requires a license due to additional licensing requirements of some contents.</li>
<li><strong>More Information:</strong> <a href="https://www.nlm.nih.gov/research/umls">UMLS - NLM</a></li>
</ul>
</section>
<section id="ontology-mapping-in-bioportal-applications" class="level3">
<h3 class="anchored" data-anchor-id="ontology-mapping-in-bioportal-applications">Ontology Mapping in BioPortal Applications</h3>
<ul>
<li><p><strong>Process:</strong> Finding the closest match of a code from one ontology in another.</p></li>
<li><p><strong>Matching:</strong> Exact equivalence is rare; approximate matching is common.</p></li>
<li><p><strong>Challenges:</strong> Labor-intensive and requires understanding the maps’ nature and limitations.</p></li>
<li><p><strong>Alternative Approach:</strong> Mapping multiple ontologies to a central core terminology, as used by the OHDSI consortium.</p></li>
<li><p><strong>More Information:</strong> <a href="https://bioportal.bioontology.org">BioPortal</a></p>
<div style="text-align: right">
<p><a href="#table-of-contents">Back to Table of Contents</a></p>
</div></li>
</ul>
<p>https://www.healthit.gov/isa/section-i-vocabularycode-setterminology-standards-and-implementation-specifications</p>
</section>
</section>
<section id="omop-domains-by-source-to-standard-vocabulary" class="level2">
<h2 class="anchored" data-anchor-id="omop-domains-by-source-to-standard-vocabulary">OMOP Domains by Source to Standard Vocabulary</h2>
<pre class="mermaid"><code>graph LR
    ICD9("ICD9") --&gt;|Transformation to OMOP CDM| SNOMED("STANDARD&lt;br&gt;Vocabulary Concept Code&lt;br&gt;SNOMED")
    ICD10("ICD10") --&gt;|Transformation to OMOP CDM| SNOMED</code></pre>
<div style="text-align: right">
<p><a href="#table-of-contents">Back to Table of Contents</a></p>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 52%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Domain</th>
<th>Source Vocabulary</th>
<th>Standard Vocabulary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Conditions</td>
<td>ICD9, ICD10</td>
<td>SNOMED</td>
</tr>
<tr class="even">
<td>Measurements</td>
<td>LOINC or institutional specific codes</td>
<td>LOINC</td>
</tr>
<tr class="odd">
<td>Drugs</td>
<td>NDC</td>
<td>RxNORM</td>
</tr>
<tr class="even">
<td>Procedures</td>
<td>ICD9, ICD10, CPT</td>
<td>SNOMED</td>
</tr>
</tbody>
</table>
<ul>
<li><p>ICD = International Classification of Diseases</p></li>
<li><p>SNOMED = Systematized Nomenclature of Medicine</p></li>
<li><p>LOINC = Logical Observation Identifiers Names and Codes</p></li>
<li><p>NDC = National Drug Code</p></li>
<li><p>CPT = Current Procedural Terminology</p>
<div style="text-align: right">
<p><a href="#table-of-contents">Back to Table of Contents</a></p>
</div></li>
</ul>
</section>
<section id="welcome-to-omop-for-matlink-users" class="level2">
<h2 class="anchored" data-anchor-id="welcome-to-omop-for-matlink-users">Welcome to OMOP for MATLINK users</h2>
<p>This site is designed to provide guidance, scripts and resources for sites transitioning data to OMOP common data model as part of MATLINK.</p>
<p>MATLINK is a public health surveillance system designed and developed by the Centers for Disease Control and Prevention (CDC) to monitor maternal, infant, and child health outcomes associated with medication for opioid use disorder during pregnancy.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The goals of OMOP are to gain better understanding of human health by improving our ability to analyze observational health data.</p>
<p>Health data is stored by individual health systems in unique ways which limits the ability to collaborate and learn from larger populations. This is a problem because certain clinical conditions are infrequent and it is important to have sufficient number of cases to perform statistical tests. De-identified data shared across institutions has the promise of allowing scientists to develop important insights about health which is the motivation to enable greater collaboration.</p>
<section id="what-is-a-common-data-model" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-common-data-model">What is a common data model?</h4>
<p>A common data model (CDM) allows multiple health care systems with their individual databases to join forces creating greater populations which can power more compelling scientific studies. A simple way to think about this is the difficulty of finding the silverware drawer in a new kitchen – if there is a unifying rule for where the silverware drawer is located in every kitchen (immediately to right of the sink) it makes it possible to find this much easier. A common data model creates a system so that data elements like “systolic blood pressure” or “sepsis” are recorded and organized in the same way. OMOP stands for Observational Medical Outcomes Partnership and is the common data model of the <a href="https://www.ohdsi.org/">Observational Health Data Sciences and Informatics</a> program.</p>
</section>
<section id="what-is-an-etl" class="level4">
<h4 class="anchored" data-anchor-id="what-is-an-etl">What is an ETL?</h4>
<p>ETL stands for Extract, Transform, and Load. Essentially this is the process of mapping data from one system to another. Please see [The Book of OHDSI, Chapter 6] (https://ohdsi.github.io/TheBookOfOhdsi/ExtractTransformLoad.html).</p>
</section>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>The code for the MATLINK project is hosted on [GitHub]XXXX</p>
</section>
<section id="matlink-technical-support-checklist" class="level2">
<h2 class="anchored" data-anchor-id="matlink-technical-support-checklist">MATLINK technical support checklist</h2>
<ol type="1">
<li><strong>TBD</strong></li>
</ol>
<section id="ohdsi-etl-resources" class="level3">
<h3 class="anchored" data-anchor-id="ohdsi-etl-resources"><u>OHDSI ETL Resources</u></h3>
<ul>
<li><a href="https://www.ohdsi.org/web/wiki/doku.php?id=documentation:etl_best_practices">OHDSI Wiki: ETL Creation Best Practices</a></li>
<li><a href="Book of OHDSI - Ch.6 Extract Transform Load">Book of OHDSI (Ch. 6): Extract Transform Load</a></li>
<li><a href="https://academy.ehden.eu/enrol/index.php?id=4">EHDEN Academy: OMOP CDM and Standardised Vocabularies</a></li>
<li><a href="https://academy.ehden.eu/course/view.php?id=7">EHDEN Academy: Extract, Transform and Load</a></li>
<li><a href="https://academy.ehden.eu/enrol/index.php?id=18">EHDEN Academy: Introduction to Usagi &amp; Code Mappings for an ETL</a></li>
</ul>
</section>
<section id="ohdsi-etl-steps" class="level3">
<h3 class="anchored" data-anchor-id="ohdsi-etl-steps"><u>OHDSI ETL Steps</u></h3>
<ol type="1">
<li><p><strong>Find your people.</strong></p>
<ol type="a">
<li>Assemble ETL team: both data experts, medical experts, CDM/vocabulary experts</li>
<li>Assign persons with medical knowledge to create code mappings</li>
<li>Assign persons with technical knowledge to implement the ETL</li>
<li>Schedule regular meetings for quality control maintenance</li>
</ol></li>
<li><p><strong>Understand your data.</strong></p>
<ol type="a">
<li>Take inventory of source data (tools: <a href="https://github.com/OHDSI/WhiteRabbit">White Rabbit</a>)
<ol type="i">
<li>List of tables in database</li>
<li>List fields in each table</li>
<li>List distinct values of each field</li>
<li>Summarize the frequency of each value of each field.</li>
</ol></li>
<li>Define relationships between source data tables and fields (tools: <a href="https://github.com/OHDSI/WhiteRabbit">Rabbit-in-a-Hat</a>)
<ol type="i">
<li>Record both relationship definition decisions and reasoning behind these decisions</li>
</ol></li>
<li>Determine standardized vocabularies that already exist in your source data (ICD-10, CPT, HCPCS, LOINC, etc.)
<ol type="i">
<li>Many commonly used standardized coding systems have already been mapped to the OMOP vocabulary – utilize the work done by others across the OHDSI community to accelerate the process of mapping your data systems to OMOP.</li>
</ol></li>
<li>Determine the coding systems in your source data that are proprietary or not already mapped to OMOP (proprietary patient/visit identifiers, account numbers, charge codes, etc.)</li>
</ol></li>
<li><p><strong>Map your codes to OMOP concepts.</strong></p>
<ol type="a">
<li>Summarize the frequency of each code from your source data code sets that will require mapping to OMOP concepts.</li>
<li>Create your source data to OMOP mapping. (tools: <a href="https://github.com/OHDSI/Usagi">Usagi</a>)
<ol type="i">
<li>Assign this task to the ETL team members with appropriate medical knowledge to discern which codes are most synonymous based on their descriptions. Medical knowledge is key for this step as semantic understanding of clinical descriptions is required to make decisions on mapping source data concepts to OMOP concepts.</li>
<li>Start with the most frequently used codes and determine your threshold of code frequency to include in the mapping.</li>
<li>Focus on a particular project or clinical domain to limit the scope of data needed for capture and conversion to OMOP.</li>
<li>Utilize the Usagi tool for mapping suggestions and searching based on similarity of code descriptions.</li>
</ol></li>
</ol></li>
<li><p><strong>OMOPify your data!</strong></p>
<ol type="a">
<li>Determine the technology and software used or approved at your site for data storage, querying, and transfer. Determine the tools and technologies that team members and internal staff have expertise in.</li>
<li>Generate the OMOP DDLs
<ol type="i">
<li>Using R: https://github.com/OHDSI/CommonDataModel</li>
<li>Using SQL: https://github.com/OHDSI/CommonDataModel/tree/v5.4.0/inst/ddl/5.4</li>
</ol></li>
<li>Implement the ETL.
<ol type="i">
<li>Assign this task to the ETL team members with technical knowledge and permission for accessing and extracting source data and writing to a database.</li>
<li>Many tools and technologies can be used for this step. Utilize the existing tools, technologies, and expertise of your ETL team and internal staff.</li>
</ol></li>
</ol></li>
<li><p><strong>Evaluate your data.</strong></p>
<ol type="a">
<li>Involve everyone in the evaluation and maintenance of ETL and data quality.</li>
<li>Review the ETL design documentation, computer code used in implementation, and concept mappings</li>
<li>Perform a manual audit using a sample of patients from both source data and derived OMOP data</li>
<li>Compare summary level counts of key fields between source data and OMOP derived data. (tools: Achilles)</li>
</ol></li>
</ol>
<p><strong>★ Ask for help along the way!</strong></p>
<p>The MATLINK support team is here to help you. We also encourage you to connect with the OHDSI community to find others with experience, expertise, and guidance for each step of your ETL to OMOP journey. The open, collaborative community of OHDSI is the most powerful tool at your disposal. Use it (us)!</p>
</section>
<section id="places-to-connect" class="level3">
<h3 class="anchored" data-anchor-id="places-to-connect"><u>Places to Connect</u></h3>
<ul>
<li><p>OHDSI.org: https://www.ohdsi.org/</p></li>
<li><p>OHDSI Wiki: https://www.ohdsi.org/web/wiki/doku.php</p></li>
<li><p>OHDSI Forums: https://forums.ohdsi.org/</p></li>
<li><p>OHDSI Workgroups: https://www.ohdsi.org/workgroups/ ```</p></li>
</ul>
</section>
</section>
<section id="omop-table-and-field-basics" class="level2">
<h2 class="anchored" data-anchor-id="omop-table-and-field-basics">OMOP Table and Field Basics</h2>
<p>Adapted from OHDSI CDM Site: <a href="https://ohdsi.github.io/CommonDataModel/dataModelConventions.html">Data Model Conventions</a></p>
<section id="tables" class="level4">
<h4 class="anchored" data-anchor-id="tables">Tables</h4>
<p>For the tables of the main domains of the CDM it is imperative that concepts used are strictly limited to the domain. For example, the CONDITION_OCCURRENCE table contains only information about conditions (diagnoses, signs, symptoms), but no information about procedures. Not all source coding schemes adhere to such rules. For example, ICD-9-CM codes, which contain mostly diagnoses of human disease, also contain information about the status of patients having received a procedure. The ICD-9-CM code V20.3 ‘Newborn health supervision’ defines a continuous procedure and is therefore stored in the PROCEDURE_OCCURRENCE table.</p>
</section>
<section id="fields" class="level4">
<h4 class="anchored" data-anchor-id="fields">Fields</h4>
<p>Variable names across all tables follow one convention:</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td><strong>Notation</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>_SOURCE_VALUE</td>
<td>Verbatim information from the source data, typically used in ETL to map to CONCEPT_ID, and not to be used by any standard analytics. For example, CONDITION_SOURCE_VALUE = ‘787.02’ was the ICD-9 code captured as a diagnosis from the administrative claim.</td>
</tr>
<tr class="odd">
<td>_ID</td>
<td>Unique identifiers for key entities, which can serve as foreign keys to establish relationships across entities. For example, PERSON_ID uniquely identifies each individual. VISIT_OCCURRENCE_ID uniquely identifies a PERSON encounter at a point of care.</td>
</tr>
<tr class="even">
<td>_CONCEPT_ID</td>
<td>Foreign key into the Standardized Vocabularies (i.e.&nbsp;the standard_concept attribute for the corresponding term is true), which serves as the primary basis for all standardized analytics. For example, CONDITION_CONCEPT_ID = <a href="http://athena.ohdsi.org/search-terms/terms/31967">31967</a> contains the reference value for the SNOMED concept of ‘Nausea’</td>
</tr>
<tr class="odd">
<td>_SOURCE_CONCEPT_ID</td>
<td>Foreign key into the Standardized Vocabularies representing the concept and terminology used in the source data, when applicable. For example, CONDITION_SOURCE_CONCEPT_ID = <a href="http://athena.ohdsi.org/search-terms/terms/45431665">45431665</a> denotes the concept of ‘Nausea’ in the Read terminology; the analogous CONDITION_CONCEPT_ID might be 31967, since SNOMED-CT is the Standardized Vocabulary for most clinical diagnoses and findings.</td>
</tr>
<tr class="even">
<td>_TYPE_CONCEPT_ID</td>
<td>Delineates the origin of the source information, standardized within the Standardized Vocabularies. For example, DRUG_TYPE_CONCEPT_ID can allow analysts to discriminate between ‘Pharmacy dispensing’ and ’Prescription written</td>
</tr>
</tbody>
</table>
<p>For more information, see:</p>
<p><a href="https://ohdsi.github.io/CommonDataModel/dataModelConventions.html#Data_Model_Conventions">Data Model Conventions</a></p>
<p><a href="https://ohdsi.github.io/CommonDataModel/drug_dose.html">How to Calculate Drug Dose</a></p>
<p><a href="https://ohdsi.github.io/CommonDataModel/cdm53.html#Clinical_Data_Tables">Clinical Data Tables</a></p>
</section>
</section>
</section>
<section id="ohdsi-tool-suite" class="level1">
<h1>OHDSI Tool Suite</h1>
<p>The Edge Tool Suite are a set of OHDSI tools that should be deployed by the site that provide value around the OMOP CDM. This work was funded by the MATLINK initiative <a href="https://cure.ncats.io" class="uri">https://cure.ncats.io</a></p>
<p>The OHDSI open source software configured for deployment include:</p>
<ul>
<li><p>The Atlas data science platform</p></li>
<li><p>The WebAPI backed for Atlas</p></li>
<li><p>The HADES statistical analysis packages</p></li>
<li><p>The Data Quality Dashboard</p></li>
<li><p>The Perseus ETL management system</p></li>
</ul>
<section id="ways-to-deploy-the-software" class="level4">
<h4 class="anchored" data-anchor-id="ways-to-deploy-the-software">Ways to deploy the software</h4>
<ol type="1">
<li>Cloud vendor software configured for use.</li>
</ol>
<p><a href="https://github.com/microsoft/OHDSIonAzure">OHDSI on Azure (Includes Perseus, Atlas, and Hades)</a></p>
<p><a href="https://github.com/OHDSI/OHDSIonAWS">OHDSI on AWS (Includes Atlas and Hades)</a></p>
<ol start="2" type="1">
<li>Broadsea provides a set of docker containers that ease the cost of implementation</li>
</ol>
<p><a href="https://github.com/OHDSI/Broadsea">Broadsea (Includes Atlas and Hades)</a></p>
<ol start="3" type="1">
<li>Sites can compile the tools from the source repositories</li>
</ol>
</section>
<section id="ohdsi-specific" class="level4">
<h4 class="anchored" data-anchor-id="ohdsi-specific">OHDSI Specific</h4>
<p><a href="https://github.com/OHDSI/CommonDataModel" class="uri">https://github.com/OHDSI/CommonDataModel</a></p>
<p><a href="https://github.com/OHDSI/Broadsea" class="uri">https://github.com/OHDSI/Broadsea</a></p>
<p><a href="https://github.com/OHDSI/Athena" class="uri">https://github.com/OHDSI/Athena</a></p>
</section>
<section id="the-etl-process" class="level4">
<h4 class="anchored" data-anchor-id="the-etl-process">The ETL Process</h4>
<p><a href="https://github.com/OHDSI/Perseus" class="uri">https://github.com/OHDSI/Perseus</a></p>
<p><a href="https://github.com/OHDSI/WhiteRabbit" class="uri">https://github.com/OHDSI/WhiteRabbit</a></p>
<p><a href="https://github.com/OHDSI/Usagi" class="uri">https://github.com/OHDSI/Usagi</a></p>
</section>
<section id="atlas-and-cohort-discovery" class="level4">
<h4 class="anchored" data-anchor-id="atlas-and-cohort-discovery">ATLAS and Cohort Discovery</h4>
<p><a href="https://github.com/OHDSI/Atlas" class="uri">https://github.com/OHDSI/Atlas</a></p>
<p><a href="https://github.com/OHDSI/WebAPI" class="uri">https://github.com/OHDSI/WebAPI</a></p>
</section>
<section id="broadsea" class="level4">
<h4 class="anchored" data-anchor-id="broadsea">Broadsea</h4>
<p><a href="https://www.youtube.com/watch?v=a9ZJURNRbUg" class="uri">https://www.youtube.com/watch?v=a9ZJURNRbUg</a></p>
</section>
<section id="data-analysis" class="level4">
<h4 class="anchored" data-anchor-id="data-analysis">Data Analysis</h4>
<p><a href="https://github.com/OHDSI/Achilles" class="uri">https://github.com/OHDSI/Achilles</a></p>
<p><a href="https://github.com/OHDSI/Hades" class="uri">https://github.com/OHDSI/Hades</a></p>
<p><a href="https://github.com/OHDSI/DataQualityDashboard" class="uri">https://github.com/OHDSI/DataQualityDashboard</a></p>
</section>
</section>
<section id="omop-scripts-for-epic" class="level1">
<h1>OMOP Scripts for Epic</h1>
<p><a href="https://userweb.epic.com/User/788dbdff-6712-4b16-aabc-98cdb1be4ff9">“The Spectrum Code”</a>: scripts and documentation created by Roger Carlson at Corewell Health</p>
<p><a href="https://userweb.epic.com/User/788dbdff-6712-4b16-aabc-98cdb1be4ff9">RUMC OMOP transition scripts from Clarity, Caboodle</a>: Code created by Rush University Medical Center</p>
</section>
<section id="using-synthetic-data" class="level1">
<h1>Using synthetic data</h1>
<p><a href="https://physionet.org/content/mimic-iv-demo-omop/0.9/1_omop_data_csv/#files-panel">MIMIC-IV</a> 100-patient demo dataset based on MIMIC to create a OMOP instance</p>
<p><a href="https://github.com/OHDSI/ETL-Synthea">Synthea</a> GitHub site with files to use the synthetic patient generator Synthea</p>
<p><a href="https://ohdsi.github.io/Eunomia/">Eunomia</a> LInk to the Eunomia GitHub.io site with instructions and standard dataset files</p>
</section>
<section id="useful-resources" class="level1">
<h1>Useful Resources</h1>
<p><a href="https://www.ohdsi.org/">Web site for the OHDSI community</a>: http://www.ohdsi.org</p>
<p><a href="https://ohdsi.github.io/TheBookOfOhdsi/">The Book of OHDSI:</a> What is OHDSI and why should I care?</p>
<p><a href="https://academy.ehden.eu/">EHDEN Academy</a> : EHDEN Academy is a site with courses for developing skills working with OHDSI</p>
<p><a href="https://www.youtube.com/playlist?list=PLpzbqK7kvfeXRQktX0PV-cRpb3EFA2e7Z">Tutorials &amp; Workshops</a> : Tutorial sessions 1-8 provide a comprehensive overview from vocabularies and creating cohorts to prediction</p>
<p><a href="https://forums.ohdsi.org/">OHDSI Forums</a> : Searchable, active user community</p>
<p><a href="https://dash.ohdsi.org/">OHDSI Community Dashboard</a> : Tracks publications, citations, researchers and activity within the OHDSI community</p>
<p><a href="https://www.youtube.com/watch?v=HhQ9x3bsv4o">Clinical Registry Efforts Within OHDSI (Sept.&nbsp;13 Community Call)</a>: Video discussing Perseus and Broadsea</p>
<p><a href="https://github.com/OHDSI/OHDSI-in-a-Box">OHDSI-in-a-Box on GitHub</a> : A learning environment created for the OHDSI community</p>
<p><a href="https://arxiv.org/ftp/arxiv/papers/2109/2109.08235.pdf">Integrating Flowsheet Data in OMOP Common Data Model for Clinical Research</a> Paper written by informatics teams at Stanford University and The Hospital for Sick Children</p>
<p><a href="https://ohdsi.github.io/CommonDataModel/cdmPrivacy.html">Guide to privacy issues in OMOP journey</a>: Article outlining how to manage protected health information</p>
<p><a href="https://github.com/OHDSI/DataQualityDashboard">DQD</a> GitHub repository for Data Quality Dashboard tool</p>
<p><a href="https://phekb.org/phenotypes">PheKB</a> A phenotype repository</p>
<p><a href="https://learn.microsoft.com/en-us/azure/architecture/example-scenario/digital-health/patient-data-ohdsi-omop-cdm">Analyze observational patient data by using OHDSI with the OMOP CDM</a> Microsoft guide to OMOP CDM</p>
<p><a href="https://github.com/microsoft/OHDSIonAzure">OHDSI on Azure GitHub</a> Automation code and documentation for deploying OHDSI CDM in Azure</p>
<p><a href="https://www.ohdsi.org/2022showcase-79/">How to develop capacity for observational research within a health system</a> Presentation on building capacity from 2022 OHDSI Collaborator Showcase</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>